<scenario name="forwarding" description="Forwarding test">
    <group name="Forwarding">
        <group name="P4rt-Program">
            <step name="P4rt-Set-Forwarding"
                  exec="docker-compose exec -T p4rtsh /p4rt/do_program.sh program"/>
            <step name="Check-Up4-Flows" requires="P4rt-Set-Forwarding"
                  exec="onos-cli-grep ${OCI} up4:read-flows '2 flows found'"/>
            <step name="Check-Flow-Rules" requires="P4rt-Set-Forwarding" delay="5"
                  exec="onos-check-flows ${OCI}"/>
        </group>
        <group name="Check-Bidi-Traffic" requires="P4rt-Program">
            <!-- Downlink -->
            <step name="Downlink-Enb-Recv-Gtp" requires="P4rt-Program"
                  exec="mn-cmd enodeb traffic.py recv-gtp -t 10"/>
            <step name="Downlink-Pdn-Send-Udp" requires="P4rt-Program" delay="5"
                  exec="mn-cmd pdn traffic.py send-udp-10"/>
            <!-- Uplink -->
            <step name="Downlink-Pdn-Recv-Udp" requires="P4rt-Program"
                  exec="mn-cmd pdn traffic.py recv-udp -t 10"/>
            <step name="Downlink-Enb-Send-Gtp" requires="P4rt-Program" delay="5"
                  exec="mn-cmd enodeb traffic.py send-gtp-10"/>
        </group>
        <group name="P4rt-Clear" requires="~Check-Bidi-Traffic">
            <step name="P4rt-Unset-Forwarding"
                  exec="docker-compose exec -T p4rtsh /p4rt/do_program.sh clear"/>
            <step name="Check-Up4-Flows-Cleared" requires="P4rt-Unset-Forwarding"
                  exec="onos-cli-grep ${OCI} up4:read-flows '0 flows found'"/>
            <step name="Check-Flow-Rules-Cleared" requires="P4rt-Unset-Forwarding" delay="5"
                  exec="onos-check-flows ${OCI}"/>
        </group>
    </group>
</scenario>